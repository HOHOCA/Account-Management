<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>账号管理系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: #f5f7fa;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* 顶部导航栏 */
        .navbar {
            background: #2c3e50;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
            z-index: 100;
        }

        .navbar-title {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
        }

        .navbar-user {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
        }

        .navbar-toggle {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            margin-right: 16px;
        }

        .navbar-toggle:hover {
            color: #40a9ff;
        }

        /* 主布局容器 */
        .layout-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            min-height: 0;
        }

        /* 左侧边栏 */
        .sidebar {
            width: 200px;
            background: #fff;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .sidebar.collapsed {
            width: 64px;
        }

        .sidebar-menu {
            flex: 1;
            padding: 16px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 24px;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            gap: 12px;
        }

        .menu-item:hover {
            background: rgba(24,144,255,0.08);
            color: #1890ff;
        }

        .menu-item.active {
            background: #e6f7ff;
            color: #1890ff;
        }

        .menu-icon {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .menu-text {
            opacity: 1;
            transition: opacity 0.3s;
            white-space: nowrap;
        }

        .sidebar.collapsed .menu-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }

        .sidebar.collapsed .menu-item {
            justify-content: center;
            padding: 12px;
        }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid #f0f0f0;
            display: flex;
            justify-content: flex-end;
        }

        .sidebar-toggle-btn {
            background: #f5f5f5;
            border: none;
            border-radius: 4px;
            padding: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            transition: all 0.3s;
        }

        .sidebar-toggle-btn:hover {
            background: #e8e8e8;
            color: #1890ff;
        }

        .sidebar.collapsed .sidebar-toggle-btn {
            justify-content: center;
            width: 100%;
        }

        .sidebar-toggle-icon {
            width: 16px;
            height: 16px;
            transition: transform 0.3s;
        }

        .sidebar.collapsed .sidebar-toggle-icon {
            transform: rotate(180deg);
        }

        /* 主内容区域 */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* 内容区域 */
        .container {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* 卡片容器 */
        .card {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .card-header {
            padding: 16px 24px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .card-body {
            padding: 24px;
        }

        /* 工具栏 */
        .toolbar {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            padding: 8px 12px 8px 36px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 240px;
            outline: none;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            border-color: #1890ff;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: #1890ff;
            color: #fff;
        }

        .btn-primary:hover {
            background: #40a9ff;
        }

        .btn-danger {
            background: #ff4d4f;
            color: #fff;
        }

        .btn-danger:hover {
            background: #ff7875;
        }

        .btn-default {
            background: #f5f5f5;
            color: #666;
            border: 1px solid #ddd;
        }

        .btn-default:hover {
            background: #e8e8e8;
            border-color: #bbb;
        }

        .btn-icon {
            width: 14px;
            height: 14px;
        }

        /* 表格 */
        .table-wrapper {
            overflow: auto;
            flex: 1;
            min-height: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto;
        }

        thead {
            background: #fafafa;
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        th {
            font-weight: 600;
            color: #333;
            font-size: 14px;
            white-space: nowrap;
            min-width: 100px;
        }

        td {
            font-size: 14px;
            color: #666;
            white-space: nowrap;
        }

        th:nth-child(1), td:nth-child(1) { min-width: 180px; }
        th:nth-child(2), td:nth-child(2) { min-width: 130px; }
        th:nth-child(3), td:nth-child(3) { min-width: 80px; }
        th:nth-child(4), td:nth-child(4) { min-width: 120px; }
        th:nth-child(5), td:nth-child(5) { min-width: 100px; }
        th:nth-child(6), td:nth-child(6) { min-width: 160px; }
        th:nth-child(7), td:nth-child(7) { min-width: 180px; }

        tbody tr:hover {
            background: #fafafa;
        }

        /* 滑动开关 */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
            display: flex;
            align-items: center;
            padding: 4px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #1890ff;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }

        .toggle-label {
            position: absolute;
            left: 58px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            white-space: nowrap;
        }

        .toggle-switch.enabled .toggle-label {
            color: #1890ff;
            font-weight: 500;
        }

        .toggle-switch.disabled .toggle-label {
            color: #999;
        }

        /* 操作按钮 */
        .action-group {
            display: flex;
            gap: 8px;
        }

        .btn-link {
            color: #1890ff;
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px 8px;
            font-size: 14px;
            text-decoration: none;
        }

        .btn-link:hover {
            color: #40a9ff;
        }

        .btn-link-danger {
            color: #ff4d4f;
        }

        .btn-link-danger:hover {
            color: #ff7875;
        }

        /* 分页 */
        .pagination {
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #f0f0f0;
        }

        .pagination-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .pagination-info {
            color: #666;
            font-size: 14px;
        }

        .page-size-select {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .page-size-select-label {
            color: #666;
            font-size: 14px;
        }

        .page-size-select-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: #f5f5f5;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .page-size-select-btn:hover {
            background: #e8e8e8;
            border-color: #bbb;
        }

        .page-size-arrow {
            width: 12px;
            height: 12px;
        }

        .pagination-controls {
            display: flex;
            gap: 8px;
        }

        .page-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            min-width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .page-btn:hover:not(:disabled):not(.active) {
            background: #f5f5f5;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f5f5f5;
        }

        .page-btn.active {
            background: #1890ff;
            color: #fff;
            border-color: #1890ff;
        }

        /* 弹窗遮罩 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.45);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.15);
            max-width: 520px;
            width: 90%;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 16px 24px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }

        .modal-close:hover {
            color: #333;
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 12px 24px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* 表单 */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #333;
        }

        .form-label .required {
            color: #ff4d4f;
            margin-left: 4px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-select:focus {
            border-color: #1890ff;
        }

        .form-input.error, .form-select.error {
            border-color: #ff4d4f;
        }

        .error-message {
            color: #ff4d4f;
            font-size: 12px;
            margin-top: 4px;
        }

        /* 双列表设计 */
        .dual-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .list-panel {
            border: 1px solid #e8e8e8;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
        }

        .list-header {
            padding: 12px;
            background: #fafafa;
            border-bottom: 1px solid #e8e8e8;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-search {
            padding: 12px;
            border-bottom: 1px solid #e8e8e8;
        }

        .list-content {
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .list-content table {
            width: 100%;
        }

        .list-content thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .list-content tbody tr:hover {
            background: #fafafa;
        }

        .list-content tbody tr {
            cursor: pointer;
        }

        .list-item {
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
        }

        .list-item:hover {
            background: #fafafa;
        }

        .list-item input[type="checkbox"] {
            cursor: pointer;
        }

        /* 设置页面样式 */
        .settings-form {
            max-width: 600px;
        }

        .form-description {
            color: #666;
            font-size: 13px;
            margin-top: 4px;
        }

        .form-input-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .form-input-small {
            width: 150px;
        }

        /* 警告样式 */
        .alert-warning {
            background: #fffbe6;
            border: 1px solid #ffe58f;
            border-radius: 4px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .alert-icon {
            margin-right: 8px;
            width: 16px;
            height: 16px;
            color: #faad14;
        }

        .tab-content {
            display: none;
            height: 100%;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <!-- 顶部导航栏 -->
    <div class="navbar">
        <div class="navbar-title">账号管理系统</div>
        <div class="navbar-user">
            <svg class="btn-icon" fill="currentColor" viewBox="0 0 16 16">
                <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
            </svg>
            <span>超级管理员</span>
        </div>
    </div>

    <!-- 主布局容器 -->
    <div class="layout-container">
        <!-- 左侧边栏 -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-menu">
                <div class="menu-item active" onclick="switchPage('account')">
                    <svg class="menu-icon" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
                    </svg>
                    <span class="menu-text">账号管理</span>
                </div>
                <div class="menu-item" onclick="switchPage('role')">
                    <svg class="menu-icon" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/>
                    </svg>
                    <span class="menu-text">角色权限</span>
                </div>
                <div class="menu-item" onclick="switchPage('settings')">
                    <svg class="menu-icon" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                        <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.292-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.292c.415.764-.42 1.6-1.185 1.184l-.292-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.292A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
                    </svg>
                    <span class="menu-text">系统设置</span>
                </div>
            </div>
            <div class="sidebar-footer">
                <button class="sidebar-toggle-btn" onclick="toggleSidebar()">
                    <svg class="sidebar-toggle-icon" id="toggleIcon" fill="currentColor" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- 主内容区域 -->
        <div class="main-content">
            <!-- 内容区域 -->
            <div class="container">
            <!-- 账号管理 -->
            <div id="accountTab" class="tab-content active">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">账号管理</div>
                        <div class="toolbar">
                            <div class="search-box">
                                <svg class="search-icon" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                                </svg>
                                <input type="text" class="search-input" placeholder="请输入工号/姓名">
                            </div>
                            <button class="btn btn-primary" onclick="openAddUserModal()">
                                <svg class="btn-icon" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                                </svg>
                                新增用户
                            </button>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>姓名/用户名</th>
                                    <th>手机号码</th>
                                    <th>性别</th>
                                    <th>角色</th>
                                    <th>账号状态</th>
                                    <th>修改时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="userTable">
                                <!-- 数据通过JS填充 -->
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination">
                        <div class="pagination-left">
                            <div class="pagination-info">共<span id="totalUsers">13</span>条</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div class="page-size-select">
                                <button class="page-size-select-btn">
                                    <span>20条/页</span>
                                    <svg class="page-size-arrow" fill="currentColor" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="pagination-controls">
                                <button class="page-btn" id="prevPage1" onclick="changePage(-1, 'user')" disabled>
                                    <svg style="width: 12px; height: 12px;" fill="currentColor" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                                    </svg>
                                </button>
                                <button class="page-btn active">1</button>
                                <button class="page-btn">2</button>
                                <button class="page-btn">3</button>
                                <button class="page-btn">4</button>
                                <button class="page-btn" id="nextPage1" onclick="changePage(1, 'user')">
                                    <svg style="width: 12px; height: 12px;" fill="currentColor" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 角色权限 -->
            <div id="roleTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">角色权限</div>
                        <div class="toolbar">
                            <button class="btn btn-primary" onclick="openAddRoleModal()">
                                <svg class="btn-icon" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                                </svg>
                                新增
                            </button>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>角色名称</th>
                                    <th>用户数量</th>
                                    <th>状态</th>
                                    <th>角色描述</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="roleTable">
                                <!-- 数据通过JS填充 -->
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination">
                        <div class="pagination-left">
                            <div class="pagination-info">共<span id="totalRoles">13</span>条</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div class="page-size-select">
                                <button class="page-size-select-btn">
                                    <span>20条/页</span>
                                    <svg class="page-size-arrow" fill="currentColor" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="pagination-controls">
                                <button class="page-btn" id="prevPage2" onclick="changePage(-1, 'role')" disabled>
                                    <svg style="width: 12px; height: 12px;" fill="currentColor" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                                    </svg>
                                </button>
                                <button class="page-btn active">1</button>
                                <button class="page-btn">2</button>
                                <button class="page-btn">3</button>
                                <button class="page-btn">4</button>
                                <button class="page-btn" id="nextPage2" onclick="changePage(1, 'role')">
                                    <svg style="width: 12px; height: 12px;" fill="currentColor" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 系统设置 -->
            <div id="settingsTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">系统设置</div>
                    </div>
                    <div class="card-body">
                        <div class="settings-form">
                            <div class="form-group">
                                <label class="form-label">超时登出设置</label>
                                <div class="form-description">
                                    当用户处于登录状态但连续未操作达到设定时间后，系统将自动登出该用户。
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">超时时间</label>
                                <div class="form-input-group">
                                    <input type="number" class="form-input form-input-small" id="timeoutInput" value="30" min="5" max="120">
                                    <span style="color: #666;">分钟</span>
                                </div>
                                <div class="form-description">
                                    建议范围：5-120分钟，默认30分钟。设置后将对所有用户生效。
                                </div>
                            </div>
                            <div class="form-group" style="margin-top: 32px;">
                                <button class="btn btn-primary" onclick="saveSettings()">
                                    保存设置
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>

    <!-- 新增用户弹窗 -->
    <div class="modal-overlay" id="addUserModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">新增用户</div>
                <button class="modal-close" onclick="closeModal('addUserModal')">
                    <svg class="btn-icon" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">姓名 <span class="required">*</span></label>
                    <input type="text" class="form-input" id="userName" placeholder="请输入姓名">
                    <div class="error-message" id="userNameError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">用户名 <span class="required">*</span></label>
                    <input type="text" class="form-input" id="userUsername" placeholder="请输入用户名">
                    <div class="error-message" id="userUsernameError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">密码 <span class="required">*</span></label>
                    <input type="password" class="form-input" id="userPassword" placeholder="请输入密码">
                    <div class="error-message" id="userPasswordError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">角色 <span class="required">*</span></label>
                    <select class="form-select" id="userRole">
                        <option value="">请选择角色</option>
                        <option value="doctor">医生</option>
                        <option value="physicist">物理师</option>
                    </select>
                    <div class="error-message" id="userRoleError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">工号</label>
                    <input type="text" class="form-input" id="userEmployeeId" placeholder="请输入工号">
                </div>
                <div class="form-group">
                    <label class="form-label">手机号码</label>
                    <input type="text" class="form-input" id="userPhone" placeholder="请输入手机号码">
                </div>
                <div class="form-group">
                    <label class="form-label">性别</label>
                    <select class="form-select" id="userGender">
                        <option value="">请选择</option>
                        <option value="male">男</option>
                        <option value="female">女</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">邮箱</label>
                    <input type="email" class="form-input" id="userEmail" placeholder="请输入邮箱">
                </div>
                <div class="form-group">
                    <label class="form-label">备注</label>
                    <input type="text" class="form-input" id="userRemarks" placeholder="请输入备注">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" onclick="closeModal('addUserModal')">取消</button>
                <button class="btn btn-primary" onclick="saveUser()">确定</button>
            </div>
        </div>
    </div>

    <!-- 重置密码确认弹窗 -->
    <div class="modal-overlay" id="resetPasswordModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">警告</div>
                <button class="modal-close" onclick="closeModal('resetPasswordModal')">
                    <svg class="btn-icon" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert-warning">
                    <svg class="alert-icon" fill="currentColor" viewBox="0 0 16 16" style="display: inline-block; vertical-align: middle;">
                        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                    </svg>
                    确定重置用户密码？
                </div>
                <div style="color: #666; font-size: 14px;">
                    重置后用户的登录密码将更新为初始密码 manteia123
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" onclick="closeModal('resetPasswordModal')">取消</button>
                <button class="btn btn-danger" onclick="confirmResetPassword()">确定</button>
            </div>
        </div>
    </div>

    <!-- 删除用户确认弹窗 -->
    <div class="modal-overlay" id="deleteUserModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">提示</div>
                <button class="modal-close" onclick="closeModal('deleteUserModal')">
                    <svg class="btn-icon" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p style="color: #666;">是否确认删除当前选中账号？</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" onclick="closeModal('deleteUserModal')">取消</button>
                <button class="btn btn-danger" onclick="confirmDeleteUser()">删除</button>
            </div>
        </div>
    </div>

    <!-- 新增角色弹窗 -->
    <div class="modal-overlay" id="addRoleModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">新增</div>
                <button class="modal-close" onclick="closeModal('addRoleModal')">
                    <svg class="btn-icon" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">角色名称 <span class="required">*</span></label>
                    <input type="text" class="form-input" id="roleName" placeholder="请输入角色名称">
                    <div class="error-message" id="roleNameError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">角色描述</label>
                    <input type="text" class="form-input" id="roleDesc" placeholder="请输入角色描述">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" onclick="closeModal('addRoleModal')">取消</button>
                <button class="btn btn-primary" onclick="saveRole()">确定</button>
            </div>
        </div>
    </div>

    <!-- 分配用户弹窗 -->
    <div class="modal-overlay" id="assignUserModal">
        <div class="modal" style="max-width: 1000px; width: 90%;">
            <div class="modal-header">
                <div class="modal-title">分配用户</div>
                <button class="modal-close" onclick="closeModal('assignUserModal')">
                    <svg class="btn-icon" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="dual-list">
                    <div class="list-panel">
                        <div class="list-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <span>可选用户</span>
                            <div style="display: flex; gap: 8px; align-items: center; flex: 1; max-width: 400px; margin-left: 16px;">
                                <input type="text" class="form-input" id="assignUserSearch" placeholder="请输入姓名" oninput="filterAvailableUsers()" onkeypress="if(event.key==='Enter')filterAvailableUsers()" style="flex: 1;">
                                <button class="btn btn-primary" onclick="filterAvailableUsers()" style="padding: 8px 12px;">
                                    <svg style="width: 14px; height: 14px;" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="list-content" id="availableUserList">
                            <!-- 动态生成 -->
                        </div>
                    </div>
                    <div class="list-panel">
                        <div class="list-header">
                            <span>已分配用户</span>
                            <button class="btn btn-primary" onclick="removeAllAssignedUsers()" style="padding: 4px 12px; font-size: 12px;">全部移除</button>
                        </div>
                        <div class="list-content" id="assignedUserList">
                            <!-- 动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" onclick="closeModal('assignUserModal')">取消</button>
                <button class="btn btn-primary">确定</button>
            </div>
        </div>
    </div>

    <!-- 修改角色弹窗 -->
    <div class="modal-overlay" id="editRoleModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">修改</div>
                <button class="modal-close" onclick="closeModal('editRoleModal')">
                    <svg class="btn-icon" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">角色名称 <span class="required">*</span></label>
                    <input type="text" class="form-input" id="editRoleName" placeholder="请输入角色名称">
                    <div class="error-message" id="editRoleNameError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">角色描述</label>
                    <input type="text" class="form-input" id="editRoleDesc" placeholder="请输入角色描述">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" onclick="closeModal('editRoleModal')">取消</button>
                <button class="btn btn-primary" onclick="updateRole()">确定</button>
            </div>
        </div>
    </div>

    <!-- 删除角色确认弹窗 -->
    <div class="modal-overlay" id="deleteRoleModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">提示</div>
                <button class="modal-close" onclick="closeModal('deleteRoleModal')">
                    <svg class="btn-icon" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p style="color: #666;">是否删除该角色？</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" onclick="closeModal('deleteRoleModal')">取消</button>
                <button class="btn btn-danger" onclick="confirmDeleteRole()">删除</button>
            </div>
        </div>
    </div>

    <!-- 角色授权弹窗 -->
    <div class="modal-overlay" id="roleAuthModal">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title">角色授权</div>
                <button class="modal-close" onclick="closeModal('roleAuthModal')">
                    <svg class="btn-icon" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
                <div id="roleAuthContent">
                    <!-- 动态生成 -->
                </div>
            </div>
            <div class="modal-footer">
                <div style="flex: 1;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-default" onclick="selectAllPermissions()" style="padding: 6px 12px; font-size: 13px;">全选所有</button>
                            <button class="btn btn-default" onclick="clearAllPermissions()" style="padding: 6px 12px; font-size: 13px;">清空所有</button>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-default" onclick="closeModal('roleAuthModal')">取消</button>
                            <button class="btn btn-primary" onclick="saveRoleAuth()">确定</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 用户数据
        const users = [
            { name: '张明华', username: 'zhangmh', phone: '13812345678', gender: '男', role: '医生', status: '启用', updateTime: '2025-10-22 14:31:00' },
            { name: '李丽娟', username: 'lilj', phone: '13787654321', gender: '女', role: '医生', status: '禁用', updateTime: '2025-10-22 14:30:00' },
            { name: '王建国', username: 'wangjg', phone: '13900112233', gender: '男', role: '医生', status: '启用', updateTime: '2025-10-22 14:29:00' },
            { name: '陈秀英', username: 'chenxy', phone: '15898765432', gender: '女', role: '物理师', status: '启用', updateTime: '2025-10-22 14:28:00' },
            { name: '刘志强', username: 'liuzq', phone: '15011112222', gender: '男', role: '物理师', status: '启用', updateTime: '2025-10-22 14:27:00' },
        ];

        const roles = [
            { name: '医生', count: 3, status: '启用', desc: '医生用户' },
            { name: '物理师', count: 2, status: '启用', desc: '物理师用户' },
        ];

        // 初始化页面
        function initPage() {
            renderUsers();
            renderRoles();
        }

        // 渲染用户表格
        function renderUsers() {
            const tbody = document.getElementById('userTable');
            tbody.innerHTML = users.map((user, index) => {
                const isEnabled = user.status === '启用';
                return `
                <tr>
                    <td>${user.name} / ${user.username}</td>
                    <td>${user.phone || ''}</td>
                    <td>${user.gender || ''}</td>
                    <td>${user.role}</td>
                    <td>
                        <label class="toggle-switch ${isEnabled ? 'enabled' : 'disabled'}">
                            <input type="checkbox" ${isEnabled ? 'checked' : ''} onchange="toggleUserStatus(${index})">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">${isEnabled ? '启用' : '禁用'}</span>
                        </label>
                    </td>
                    <td>${user.updateTime}</td>
                    <td>
                        <div class="action-group">
                            <a href="#" class="btn-link" onclick="editUser('${user.username}')">编辑</a>
                            <a href="#" class="btn-link" onclick="resetPassword('${user.username}')">重置</a>
                            <a href="#" class="btn-link btn-link-danger" onclick="deleteUser('${user.username}')">删除</a>
                        </div>
                    </td>
                </tr>
            `;
            }).join('');
        }

        // 切换用户状态
        function toggleUserStatus(index) {
            const user = users[index];
            user.status = user.status === '启用' ? '禁用' : '启用';
            renderUsers();
        }

        // 渲染角色表格
        function renderRoles() {
            const tbody = document.getElementById('roleTable');
            tbody.innerHTML = roles.map((role, index) => {
                const isEnabled = role.status === '启用';
                return `
                <tr>
                    <td>${role.name}</td>
                    <td>${role.count}</td>
                    <td>
                        <label class="toggle-switch ${isEnabled ? 'enabled' : 'disabled'}">
                            <input type="checkbox" ${isEnabled ? 'checked' : ''} onchange="toggleRoleStatus(${index})">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">${isEnabled ? '启用' : '禁用'}</span>
                        </label>
                    </td>
                    <td>${role.desc}</td>
                    <td>
                        <div class="action-group">
                            <a href="#" class="btn-link" onclick="openRoleAuth('${role.name}', ${index})">角色授权</a>
                            <a href="#" class="btn-link" onclick="assignUser('${role.name}')">分配用户</a>
                            <a href="#" class="btn-link" onclick="editRole(${index})">修改</a>
                            <a href="#" class="btn-link btn-link-danger" onclick="deleteRole('${role.name}')">删除</a>
                        </div>
                    </td>
                </tr>
            `;
            }).join('');
        }

        // 切换角色状态
        function toggleRoleStatus(index) {
            const role = roles[index];
            role.status = role.status === '启用' ? '禁用' : '启用';
            renderRoles();
        }

        // 切换页面
        function switchPage(page) {
            // 隐藏所有标签页
            document.getElementById('accountTab').classList.remove('active');
            document.getElementById('roleTab').classList.remove('active');
            document.getElementById('settingsTab').classList.remove('active');

            // 显示选中的标签页
            document.getElementById(page + 'Tab').classList.add('active');

            // 更新菜单激活状态
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.menu-item').classList.add('active');
        }

        // 清除所有错误状态
        function clearErrors() {
            const inputs = document.querySelectorAll('#addUserModal .form-input, #addUserModal .form-select');
            inputs.forEach(input => {
                input.classList.remove('error');
            });
            const errorMessages = document.querySelectorAll('#addUserModal .error-message');
            errorMessages.forEach(msg => {
                msg.textContent = '';
            });
        }

        // 打开弹窗
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        // 关闭弹窗
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // 新增用户
        function openAddUserModal() {
            // 更新弹窗标题
            document.querySelector('#addUserModal .modal-title').textContent = '新增用户';
            clearErrors();
            openModal('addUserModal');
        }

        // 显示错误
        function showError(fieldId, message) {
            const field = document.getElementById(fieldId);
            const errorElement = document.getElementById(fieldId + 'Error');
            if (field) {
                field.classList.add('error');
            }
            if (errorElement) {
                errorElement.textContent = message;
            }
        }

        // 验证表单
        function validateForm() {
            let isValid = true;
            clearErrors();

            // 验证姓名
            const name = document.getElementById('userName').value.trim();
            if (!name) {
                showError('userName', '请输入姓名');
                isValid = false;
            }

            // 验证用户名
            const username = document.getElementById('userUsername').value.trim();
            if (!username) {
                showError('userUsername', '请输入用户名');
                isValid = false;
            } else if (username.length < 2 || username.length > 18) {
                showError('userUsername', '用户名应大于1个字符且小于19个字符');
                isValid = false;
            }

            // 验证密码
            const password = document.getElementById('userPassword').value;
            if (!password) {
                showError('userPassword', '请输入密码');
                isValid = false;
            }

            // 验证角色
            const role = document.getElementById('userRole').value;
            if (!role) {
                showError('userRole', '请选择角色');
                isValid = false;
            }

            return isValid;
        }

        function saveUser() {
            if (!validateForm()) {
                return;
            }
            
            // 获取表单数据
            const name = document.getElementById('userName').value.trim();
            const username = document.getElementById('userUsername').value.trim();
            const password = document.getElementById('userPassword').value;
            const role = document.getElementById('userRole').value;
            const employeeId = document.getElementById('userEmployeeId').value.trim();
            const phone = document.getElementById('userPhone').value.trim();
            const gender = document.getElementById('userGender').value;
            const email = document.getElementById('userEmail').value.trim();
            const remarks = document.getElementById('userRemarks').value.trim();
            
            // 获取角色显示名称
            const roleDisplayName = role === 'doctor' ? '医生' : '物理师';
            
            // 创建新用户对象
            const now = new Date();
            const updateTime = now.getFullYear() + '-' + 
                String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                String(now.getDate()).padStart(2, '0') + ' ' + 
                String(now.getHours()).padStart(2, '0') + ':' + 
                String(now.getMinutes()).padStart(2, '0') + ':' + 
                String(now.getSeconds()).padStart(2, '0');
            
            const newUser = {
                name: name,
                username: username,
                phone: phone || '',
                gender: gender === 'male' ? '男' : (gender === 'female' ? '女' : ''),
                role: roleDisplayName,
                status: '启用',
                updateTime: updateTime
            };
            
            // 添加到数组的第一位
            users.unshift(newUser);
            
            // 更新总数
            document.getElementById('totalUsers').textContent = users.length;
            
            // 重新渲染用户列表
            renderUsers();
            
            alert('保存成功！');
            closeModal('addUserModal');
            
            // 清除表单
            clearErrors();
            document.getElementById('userName').value = '';
            document.getElementById('userUsername').value = '';
            document.getElementById('userPassword').value = '';
            document.getElementById('userRole').value = '';
            document.getElementById('userEmployeeId').value = '';
            document.getElementById('userPhone').value = '';
            document.getElementById('userGender').value = '';
            document.getElementById('userEmail').value = '';
            document.getElementById('userRemarks').value = '';
        }

        // 重置密码
        function resetPassword(username) {
            openModal('resetPasswordModal');
        }

        function confirmResetPassword() {
            alert('密码已重置为 admin123');
            closeModal('resetPasswordModal');
        }

        // 删除用户
        function deleteUser(username) {
            openModal('deleteUserModal');
        }

        function confirmDeleteUser() {
            alert('删除成功！');
            closeModal('deleteUserModal');
        }

        // 编辑用户
        function editUser(username) {
            // 更新弹窗标题
            document.querySelector('#addUserModal .modal-title').textContent = '编辑用户';
            openModal('addUserModal');
        }

        // 清除角色错误状态
        function clearRoleErrors() {
            const roleNameInput = document.getElementById('roleName');
            const roleNameError = document.getElementById('roleNameError');
            if (roleNameInput) {
                roleNameInput.classList.remove('error');
            }
            if (roleNameError) {
                roleNameError.textContent = '';
            }
        }

        // 验证角色表单
        function validateRoleForm() {
            let isValid = true;
            clearRoleErrors();

            // 验证角色名称
            const roleName = document.getElementById('roleName').value.trim();
            if (!roleName) {
                document.getElementById('roleName').classList.add('error');
                document.getElementById('roleNameError').textContent = '请输入角色名称';
                isValid = false;
            }

            return isValid;
        }

        // 新增角色
        function openAddRoleModal() {
            clearRoleErrors();
            openModal('addRoleModal');
        }

        function saveRole() {
            if (!validateRoleForm()) {
                return;
            }
            
            // 获取表单数据
            const roleName = document.getElementById('roleName').value.trim();
            const roleDesc = document.getElementById('roleDesc').value.trim();
            
            // 创建新角色对象
            const newRole = {
                name: roleName,
                count: 0,
                status: '启用',
                desc: roleDesc || ''
            };
            
            // 添加到数组的第一位
            roles.unshift(newRole);
            
            // 更新总数
            document.getElementById('totalRoles').textContent = roles.length;
            
            // 重新渲染角色列表
            renderRoles();
            
            alert('保存成功！');
            closeModal('addRoleModal');
            
            // 清除表单
            clearRoleErrors();
            document.getElementById('roleName').value = '';
            document.getElementById('roleDesc').value = '';
        }

        // 分配用户相关数据
        let currentAssigningRole = '';
        let assignedUsers = [];
        let availableUsersFiltered = [];

        // 分配用户
        function assignUser(roleName) {
            currentAssigningRole = roleName;
            assignedUsers = [];
            loadAvailableUsers();
            renderAssignedUsers();
            openModal('assignUserModal');
        }

        // 加载可用用户列表
        function loadAvailableUsers() {
            // 获取所有没有分配角色的用户（这里简化处理，获取所有医生和物理师）
            availableUsersFiltered = users.filter(user => user.status === '启用');
            renderAvailableUsers();
        }

        // 渲染可用用户列表
        function renderAvailableUsers() {
            const searchText = document.getElementById('assignUserSearch')?.value || '';
            const filtered = availableUsersFiltered.filter(user => 
                (user.name.includes(searchText) || user.username.includes(searchText))
            );
            
            const container = document.getElementById('availableUserList');
            if (!container) return;
            
            const allChecked = filtered.length > 0 && filtered.every(user => assignedUsers.includes(user.username));
            const hasUnchecked = filtered.some(user => !assignedUsers.includes(user.username));
            
            container.innerHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="background: #fafafa;">
                            <tr>
                                <th style="padding: 8px 0 8px 12px; text-align: left; font-size: 14px; font-weight: 600; color: #333; width: auto; min-width: fit-content;">
                                    <input type="checkbox" id="selectAllUsers" ${allChecked && !hasUnchecked ? 'checked' : ''} onchange="toggleSelectAllUsers(this.checked)">
                                </th>
                                <th style="padding: 8px 12px; text-align: left; font-size: 14px; font-weight: 600; color: #333;">姓名</th>
                                <th style="padding: 8px 12px; text-align: left; font-size: 14px; font-weight: 600; color: #333;">工号</th>
                                <th style="padding: 8px 12px; text-align: left; font-size: 14px; font-weight: 600; color: #333;">用户类型</th>
                            </tr>
                    </thead>
                    <tbody>
                        ${filtered.map((user, index) => {
                            const isChecked = assignedUsers.includes(user.username);
                            return `
                            <tr style="border-bottom: 1px solid #f0f0f0;">
                                <td style="padding: 8px 0 8px 12px; width: auto; min-width: fit-content;">
                                    <input type="checkbox" id="availUser${index}" ${isChecked ? 'checked' : ''} onchange="toggleAvailableUser('${user.username}', this.checked)">
                                </td>
                                <td style="padding: 8px 12px; font-size: 14px; color: #666;">${user.name}</td>
                                <td style="padding: 8px 12px; font-size: 14px; color: #666;">${user.username}</td>
                                <td style="padding: 8px 12px; font-size: 14px; color: #666;">${user.role}</td>
                            </tr>
                        `;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }

        // 全选/取消全选
        function toggleSelectAllUsers(isChecked) {
            const searchText = document.getElementById('assignUserSearch')?.value || '';
            const filtered = availableUsersFiltered.filter(user => 
                (user.name.includes(searchText) || user.username.includes(searchText))
            );
            
            if (isChecked) {
                // 全选：添加所有可见用户
                filtered.forEach(user => {
                    if (!assignedUsers.includes(user.username)) {
                        assignedUsers.push(user.username);
                    }
                });
            } else {
                // 取消全选：移除所有可见用户
                const visibleUsernames = filtered.map(u => u.username);
                assignedUsers = assignedUsers.filter(u => !visibleUsernames.includes(u));
            }
            
            renderAssignedUsers();
            renderAvailableUsers();
        }

        // 切换可用用户选择
        function toggleAvailableUser(username, isChecked) {
            if (isChecked) {
                // 添加到已分配列表
                if (!assignedUsers.includes(username)) {
                    assignedUsers.push(username);
                }
            } else {
                // 从已分配列表移除
                assignedUsers = assignedUsers.filter(u => u !== username);
            }
            renderAssignedUsers();
        }

        // 渲染已分配用户列表
        function renderAssignedUsers() {
            const container = document.getElementById('assignedUserList');
            if (!container) return;
            
            if (assignedUsers.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="background: #fafafa;">
                        <tr>
                            <th style="padding: 8px 12px; text-align: left; font-size: 14px; font-weight: 600; color: #333;">姓名</th>
                            <th style="padding: 8px 12px; text-align: left; font-size: 14px; font-weight: 600; color: #333;">工号</th>
                            <th style="padding: 8px 12px; text-align: left; font-size: 14px; font-weight: 600; color: #333;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${assignedUsers.map(username => {
                            const user = users.find(u => u.username === username);
                            if (!user) return '';
                            return `
                            <tr style="border-bottom: 1px solid #f0f0f0;">
                                <td style="padding: 8px 12px; font-size: 14px; color: #666;">${user.name}</td>
                                <td style="padding: 8px 12px; font-size: 14px; color: #666;">${user.username}</td>
                                <td style="padding: 8px 12px;">
                                    <button class="remove-btn" onclick="removeAssignedUser('${username}')" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 12px; border: 1px solid #ff4d4f; border-radius: 4px; background: #fff; color: #ff4d4f; cursor: pointer; font-size: 14px; transition: all 0.3s;" onmouseover="this.style.background='#ff4d4f'; this.style.color='#fff'" onmouseout="this.style.background='#fff'; this.style.color='#ff4d4f'">
                                        <svg style="width: 14px; height: 14px;" fill="currentColor" viewBox="0 0 16 16">
                                            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                            <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                        </svg>
                                        <span>移除</span>
                                    </button>
                                </td>
                            </tr>
                        `;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }

        // 移除单个已分配用户
        function removeAssignedUser(username) {
            assignedUsers = assignedUsers.filter(u => u !== username);
            renderAssignedUsers();
            renderAvailableUsers();
        }

        // 移除所有已分配用户
        function removeAllAssignedUsers() {
            assignedUsers = [];
            renderAssignedUsers();
            renderAvailableUsers();
        }

        // 搜索过滤用户
        function filterAvailableUsers() {
            renderAvailableUsers();
        }

        // 编辑角色
        let editingRoleIndex = -1;

        function editRole(index) {
            editingRoleIndex = index;
            const role = roles[index];
            document.getElementById('editRoleName').value = role.name;
            document.getElementById('editRoleDesc').value = role.desc || '';
            clearEditRoleErrors();
            openModal('editRoleModal');
        }

        // 清除编辑角色错误状态
        function clearEditRoleErrors() {
            const roleNameInput = document.getElementById('editRoleName');
            const roleNameError = document.getElementById('editRoleNameError');
            if (roleNameInput) {
                roleNameInput.classList.remove('error');
            }
            if (roleNameError) {
                roleNameError.textContent = '';
            }
        }

        // 更新角色
        function updateRole() {
            // 验证
            const roleName = document.getElementById('editRoleName').value.trim();
            if (!roleName) {
                document.getElementById('editRoleName').classList.add('error');
                document.getElementById('editRoleNameError').textContent = '请输入角色名称';
                return;
            }

            if (editingRoleIndex >= 0 && editingRoleIndex < roles.length) {
                roles[editingRoleIndex].name = roleName;
                roles[editingRoleIndex].desc = document.getElementById('editRoleDesc').value.trim();
                renderRoles();
                alert('修改成功！');
                closeModal('editRoleModal');
                editingRoleIndex = -1;
            }
        }

        // 删除角色
        let deletingRoleName = '';

        function deleteRole(roleName) {
            deletingRoleName = roleName;
            openModal('deleteRoleModal');
        }

        function confirmDeleteRole() {
            roles = roles.filter(role => role.name !== deletingRoleName);
            renderRoles();
            // 更新总数
            document.getElementById('totalRoles').textContent = roles.length;
            alert('删除成功！');
            closeModal('deleteRoleModal');
            deletingRoleName = '';
        }

        // 权限数据定义
        const permissions = [
            {
                module: '靶区勾画',
                features: ['画笔', '画刷', '橡皮擦', '多边形工具', '圆形工具', '矩形工具']
            },
            {
                module: '计划设计',
                features: ['播放MLC', '射束适形', '剂量率设置', '机架角设置', '准直器设置']
            },
            {
                module: '计划优化',
                features: ['计划优化', '剂量计算', '目标函数设置', '约束条件设置', '优化算法选择']
            },
            {
                module: '剂量验证',
                features: ['剂量计算', '剂量分布', 'DVH分析', '适形度分析']
            },
            {
                module: '报告生成',
                features: ['计划报告', '剂量报告', '图表导出', 'PDF导出']
            },
            {
                module: '患者管理',
                features: ['患者信息查看', '患者信息编辑', '患者导入', '患者导出']
            }
        ];

        // 角色授权
        let currentAuthingRoleName = '';
        let currentAuthingRoleIndex = -1;
        let selectedPermissions = {}; // 存储选中的权限

        function openRoleAuth(roleName, index) {
            currentAuthingRoleName = roleName;
            currentAuthingRoleIndex = index;
            selectedPermissions = {}; // 重置选中权限
            
            renderPermissionList();
            openModal('roleAuthModal');
        }

        // 渲染权限列表
        function renderPermissionList() {
            const container = document.getElementById('roleAuthContent');
            container.innerHTML = permissions.map((perm, moduleIndex) => {
                const moduleCheckboxes = perm.features.map((feature, featureIndex) => {
                    const uniqueId = `perm_${moduleIndex}_${featureIndex}`;
                    const isChecked = selectedPermissions[uniqueId] || false;
                    return `
                        <label style="display: flex; align-items: center; margin-bottom: 8px; cursor: pointer; user-select: none;">
                            <input type="checkbox" id="${uniqueId}" ${isChecked ? 'checked' : ''} 
                                onchange="togglePermission('${uniqueId}', this.checked)" 
                                style="margin-right: 8px; width: 16px; height: 16px; cursor: pointer;">
                            <span style="font-size: 14px;">${feature}</span>
                        </label>
                    `;
                }).join('');
                
                // 计算该模块是否全选
                const allChecked = perm.features.every((feature, featureIndex) => {
                    const uniqueId = `perm_${moduleIndex}_${featureIndex}`;
                    return selectedPermissions[uniqueId];
                });
                
                return `
                    <div class="form-group" style="border: 1px solid #f0f0f0; border-radius: 4px; padding: 12px; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; margin-bottom: 12px;">
                            <label style="display: flex; align-items: center; cursor: pointer; user-select: none; margin-right: 12px;">
                                <input type="checkbox" id="module_${moduleIndex}" ${allChecked ? 'checked' : ''}
                                    onchange="toggleModule(${moduleIndex}, this.checked)"
                                    style="margin-right: 6px; width: 14px; height: 14px; cursor: pointer;">
                            </label>
                            <label class="form-label" style="margin-bottom: 0; flex: 1; font-size: 16px; font-weight: 600; color: #333;">${perm.module}</label>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${moduleCheckboxes}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 切换单个权限
        function togglePermission(permissionId, isChecked) {
            selectedPermissions[permissionId] = isChecked;
            updateModuleSelectAll();
        }

        // 切换模块全选
        function toggleModule(moduleIndex, isChecked) {
            const perm = permissions[moduleIndex];
            perm.features.forEach((feature, featureIndex) => {
                const uniqueId = `perm_${moduleIndex}_${featureIndex}`;
                selectedPermissions[uniqueId] = isChecked;
                const checkbox = document.getElementById(uniqueId);
                if (checkbox) checkbox.checked = isChecked;
            });
        }

        // 更新模块全选状态
        function updateModuleSelectAll() {
            permissions.forEach((perm, moduleIndex) => {
                const allChecked = perm.features.every((feature, featureIndex) => {
                    const uniqueId = `perm_${moduleIndex}_${featureIndex}`;
                    return selectedPermissions[uniqueId];
                });
                const moduleCheckbox = document.getElementById(`module_${moduleIndex}`);
                if (moduleCheckbox) {
                    moduleCheckbox.checked = allChecked;
                }
            });
        }

        // 全选所有权限
        function selectAllPermissions() {
            permissions.forEach((perm, moduleIndex) => {
                toggleModule(moduleIndex, true);
            });
            updateModuleSelectAll();
        }

        // 清空所有权限
        function clearAllPermissions() {
            // 清空选中状态
            selectedPermissions = {};
            // 重新初始化所有checkbox状态
            permissions.forEach((perm, moduleIndex) => {
                perm.features.forEach((feature, featureIndex) => {
                    const uniqueId = `perm_${moduleIndex}_${featureIndex}`;
                    selectedPermissions[uniqueId] = false;
                });
            });
            // 重新渲染
            renderPermissionList();
        }

        function saveRoleAuth() {
            const selectedCount = Object.values(selectedPermissions).filter(v => v).length;
            alert(`授权成功！已选择 ${selectedCount} 项权限`);
            closeModal('roleAuthModal');
        }

        // 切换侧边栏
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
        }

        // 保存设置
        function saveSettings() {
            const timeout = document.getElementById('timeoutInput').value;
            alert('设置已保存！超时时间已设置为 ' + timeout + ' 分钟');
        }

        // 分页
        function changePage(direction, type) {
            console.log('Change page:', direction, type);
        }

        // 页面加载完成后初始化
        initPage();

        // 点击遮罩层关闭弹窗
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.remove('active');
            }
        });
    </script>
</body>
</html>